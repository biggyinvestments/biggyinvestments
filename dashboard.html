<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard</title>
    <link rel="stylesheet" href="./css/dashboard.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;1,100;1,200&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;400;500;600&family=Protest+Guerrilla&display=swap" rel="stylesheet">

<style>


</style>
</head>
<body>

  <header class="navbar">
    <div class="container1">
        <div class="header-flex">
            <div class="logo">

                <a href="index.html"><img src="" alt=""><img src="./images/biggy logo.png" alt=""></a>
            </div>
            <nav class="nav-menu">
                <ul>
                    
                    <li><a href="#home">Home</a></li>
                    <li><a href="#about">About</a></li>
                    <li><a href="#news">Crypto News</a></li>
                    <li><a href="#partners">Partners</a></li>
                    <li><a href="#contact">Contact</a></li>
                    <button class="signup-btn">Sign Up</button>
                </ul>
            </nav>
        </div>
    </div>
</header>
<!-- The menu button -->
<div class="menu-container">
  <div class="flexer">
    <button class="menu-button">Menu</button>
    <button>Invest Now</button>
  </div>
  <!-- The menu items container -->
  <div class="menu-items">
    <!-- Menu items -->
    <ul>
      <li><a href="#"><img src="https://cdn-icons-png.freepik.com/256/12533/12533274.png?uid=R55814283&ga=GA1.1.1328920485.1725346503&semt=ais_hybrid" alt="">Account</a></li><hr style="">

      <li><a href="invest.html"><img src="https://cdn-icons-png.freepik.com/256/6459/6459506.png?uid=R55814283&ga=GA1.1.1328920485.1725346503&semt=ais_hybrid" alt="">Make Deposit</a></li><hr>

      <li><a href="earning-history.html"><img src="https://cdn-icons-png.freepik.com/256/8407/8407593.png?uid=R55814283&ga=GA1.1.1328920485.1725346503&semt=ais_hybrid" alt="">Earning History</a></li><hr>

      <li><a href="user-withdrawal.html"><img src="https://cdn-icons-png.freepik.com/256/5271/5271455.png?uid=R55814283&ga=GA1.1.1328920485.1725346503&semt=ais_hybrid" alt="">Withdraw</a></li><hr>

      <li><a href="#"><img src="https://cdn-icons-png.freepik.com/256/16766/16766605.png?uid=R55814283&ga=GA1.1.1328920485.1725346503&semt=ais_hybrid" alt="">Withdrawal History</a></li><hr>

      <li><a href="#"><img src="https://cdn-icons-png.freepik.com/256/16389/16389876.png?uid=R55814283&ga=GA1.1.1328920485.1725346503&semt=ais_hybrid" alt="">Edit Profile</a></li><hr>

      <li><a href="#"><img src="https://cdn-icons-png.freepik.com/256/3541/3541911.png?uid=R55814283&ga=GA1.1.1328920485.1725346503&semt=ais_hybrid" alt="">Logout</a></li>
    </ul>
  </div>
</div>

    
</div>

  <div class="dashboard-container">
    
    
    <div class="body">
        <aside class="dashboard-sidebar">
            <nav>
              <ul>
               
              </ul>
            </nav>
          </aside>
          


          
        <!-- <div id="user-data">   -->
          <main class="dashboard-main">

            <header class="dashboard-header">
              <div class="user-info">
                <h4 style="text-align: left; font-size: 13px;">Welcome! <h2 id="username"></h2></h4>
                <!-- <p>Sign up Date: <p id="created-at"></p><br> -->
                  Last access: <p id="days-since-creation"></p>
                </p>
              </div>
             
              <div class="profile-settings">
                <img src="https://cdn-icons-png.freepik.com/256/16389/16389876.png?uid=R55814283&ga=GA1.1.1328920485.1725346503&semt=ais_hybrid" alt="Profile" class="profile-pic">
               
              </div>
            </header><br>
          <div class="items">
            <div class="items-child">
              <div class="card1"><img src="https://img.freepik.com/premium-vector/information-info-square-button-box-help-faq-support-concept-3d-vector-icon-cartoon-minimal-style_365941-1106.jpg?uid=R55814283&ga=GA1.2.1328920485.1725346503&semt=ais_hybrid" alt=""><br>
                Security note:  Please activate <em>Two factor Aunthentication</em> to keep your account.
              </div>
            </div>



            <div class="virtual-card-section">
              <div class="virtual-card">
                
                
                <div class="card-details">
                  <div class="card-logo">
                    <img src="./images/memecoin logo.png" alt="" style="margin-left: 2rem;">
                  </div>
                  <div class="card-number">**** **** **** 1234</div>
                  <!-- <div class="card-holder">
                    <span>Card Holder</span>
                    <span>John Doe</span>
                  </div> -->
                  <!-- <div class="card-expiry">
                    <span>Expiry</span>
                    <span>12/25</span>
                  </div> -->
                  <div class="card-brand">VISA</div>
                </div>
              </div>
            </div>

           
          </div>

          <div class="tabs">
            <div class="tab">
              
              <p id="balance"></p><hr  style="border-style: solid; border-color: rgba(116, 0, 0, 1);">
              <h3>ACOUNT BALANCE</h3>
            </div>

            <div class="tab">
             
              <span id="mostRecentActiveDeposit">0</span></p><hr style="border-style: solid; border-color: rgba(116, 0, 0, 1);">
              <h3>ACTIVE DEPOSIT</h3>
            </div>

          </div>
              

            <br><br><br><b></b>
            
            
           

            
            <table class="bottom-table" cellspacing="0" cellpadding="2" border="0">
              <tbody><tr>
               <td>Pending Withdrawal:</td>
               <td class="text-right">$<span id="totalPendingWithdrawals">0</span></td>
              </tr>
              <tr>
               <td>Withdrew Total:</td>
               <td class="text-right">$ <span id="totalWithdrawn">0</span></td>
              </tr><tr>
               <td>Earned Total:</td>
              <td class="text-right">$<span id="totalEarned">0</span></td>
              </tr>
              <td>Last Deposit:</td>
              <td class="text-right">$<span id="lastDeposit">0</span></td>
             </tr>
           
             <tr>
              <td>Total Approved Deposit:</td>
              <td class="text-right">$<span id="totalDeposits">0</span></td>
             </tr>
           
              
             <tr>
              <td>Last Withdrawal:</td>
              <td class="text-right">$<span id="lastWithdrawal">0</span></td>
             </tr>
            </tbody></table>


           <div class="affiliate">
            
           </div>
            
            <section class="charts-section">
              <canvas id="investmentChart" style="font-size: 8px;"></canvas>
              <canvas id="cryptoChart"></canvas>
            </section>
            
           
          </main>
    </div>
    
</div>

<script>
  // Client-side JavaScript code
  const username = localStorage.getItem('username');
fetch(`/users?username=${username}`, {
  method: 'GET',
  headers: {
    'Content-Type': 'application/json'
  }
})
.then(response => response.json())
.then(data => {
  console.log(data);
  // Check if the response data is an array
  if (Array.isArray(data)) {
    
    const userData = data[0];
    document.getElementById('username').innerHTML = ` ${userData.username}`;
    document.getElementById('balance').innerHTML = ` ${userData.balance}`;
    document.getElementById('total-withdrawals').innerHTML = `Total Withdrawals: ${userData.total_withdrawals}`;
    document.getElementById('total-deposits').innerHTML = `Total Deposits: ${userData.total_deposits}`;
    document.getElementById('created-at').innerHTML = `Created at: ${userData.created_at}`;
    document.getElementById('days-since-creation').innerHTML = `Days since creation: ${userData.days_since_creation}`;
  } else {
    // If it's not an array, handle the error
    console.error('Invalid response data');
  }
})
.catch(error => console.error(error));




    const ctx = document.getElementById('investmentChart').getContext('2d');
const investmentChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'],
        datasets: [{
            label: 'Investments',
            data: [1000, 2000, 3000, 4000, 5000, 6000, 8000, 2000, 5000, 10000,6000, 7000],
            backgroundColor: 'rgba(87, 2, 183, 0.4)',
            borderColor: ' rgb(255, 196, 77)',
            borderWidth: 2,
            fill: true
        }]
    },
    options: {
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});


// Function to load user dashboard data
async function loadUserDashboard() {
  const username = localStorage.getItem('username'); // Assuming username is stored in localStorage

  if (!username) {
    console.error('Username not found in localStorage');
    return;
  }

  try {
    const response = await fetch(`/api/user-dashboard?username=${username}`);
    const data = await response.json();

    if (response.ok) {
      // Update the DOM with the returned data
      document.getElementById('mostRecentActiveDeposit').textContent = data.mostRecentActiveDeposit || 0;
      document.getElementById('totalPendingWithdrawals').textContent = data.totalPendingWithdrawals || 0;
      document.getElementById('totalWithdrawn').textContent = data.totalWithdrawn || 0;
      document.getElementById('totalEarned').textContent = data.totalEarned || 0;
      document.getElementById('lastDeposit').textContent = data.lastDeposit || 0;
      document.getElementById('totalDeposits').textContent = data.totalDeposits || 0;
      document.getElementById('lastWithdrawal').textContent = data.lastWithdrawal || 0;
    } else {
      console.error('Error fetching data:', data.message);
    }
  } catch (error) {
    console.error('Error fetching user dashboard data:', error);
  }
}

// Call the function when the page loads
window.onload = loadUserDashboard;
</script>
</body>
</html>