<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard</title>
    <meta name="theme-color" content="  #740000">
    <meta name="apple-mobile-web-app-status-bar-style" content="  #740000">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="./css/dashboard.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;1,100;1,200&display=swap" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;400;500;600&family=Protest+Guerrilla&display=swap" rel="stylesheet">

<style>
/* Sliding Menu */
.top-menu {
    position: fixed;
    top: -100%;
    left: 0;
    width: 100vw;
    height: 400px;
    background-color: rgba(255, 255, 255, 0.782);
    padding-top: 60px;
    transition: 0.3s;
    z-index: 1000;
    
}

.top-menu a {
    padding: 10px 15px;
    text-decoration: none;
    font-size: 15px;
    color: rgba(116, 0, 0, 1);
    display: block;
    transition: 0.3s;
    font-weight: bolder;
    
}

.menu-btn{
  position: absolute;
  top: rem;
  right: 25px;
  font-weight: bolder;
  font-family: "Protest Guerrilla", sans-serif;
  font-size: 20px;
}

.top-menu a:hover {
    background-color: #575757;
}

/* Overlay for background when menu is open */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    visibility: hidden;
    opacity: 0;
    transition: 0.3s;
    z-index: 999;
}

/* Show menu and overlay */
.top-menu.active {
    top: 0;
}

.overlay.active {
    visibility: visible;
    opacity: 1;
}

</style>
</head>
<body>

  <header class="navbar">
    <div class="container1">
        <div class="header-flex">
            <div class="logo">

                <a href="index.html"><img src="" alt=""><img src="./images/biggy logo.png" alt=""></a>
            </div>
            <nav class="nav-menu">
                <ul>
                    
                    <li><a href="#home">Home</a></li>
                    <li><a href="#about">About</a></li>
                    <li><a href="#news">Crypto News</a></li>
                    <li><a href="#partners">Partners</a></li>
                    <li><a href="#contact">Contact</a></li>
                    <button class="signup-btn">Sign Up</button>
                </ul>
            </nav>
        </div>
    </div>
</header>
<!-- The menu button -->
<div class="menu-container">
  <div class="flexer">
    <span class="menu-btn">&#9776; Menu</span>
    <a href="invest.html"><button>Invest Now</button></a>
  </div>

 <div class="overlay" id="overlay"></div> 
  

  <div class="top-menu" id="topMenu">
     
    <a href="get-account-details.html">Account</a></li><hr style="">

      <a href="invest.html">Make Deposit</a></li><hr>

      <a href="earning-history.html">Earning History</a></li><hr>

      <a href="user-withdrawal.html">Withdraw</a></li><hr>

      <a href="withdrawal-history.html">Withdrawal History</a></li><hr>

     <a href="profile.html">Edit Profile</a></li><hr>

      <a href="signin.html">Logout</a>
  </div>
  <!-- The menu items container -->
  <div class="menu-items">
    <!-- Menu items -->
    <ul>
     
    </ul>
  </div>
</div>



  <div class="dashboard-container"> 
    <div class="body">    
    <!-- <div id="user-data">   -->
          <main class="dashboard-main">

            <header class="dashboard-header">
              <div class="user-info">
                <h4 style="text-align: left; font-size: 13px;">Welcome! <h2 id="username"></h2></h4>
                <!-- <p>Sign up Date: <p id="created-at"></p><br> -->
                  Last access: <p id="days-since-creation"></p>
                </p>
              </div>
             
              <div class="profile-settings">
                <img src="https://cdn-icons-png.freepik.com/256/16389/16389876.png?uid=R55814283&ga=GA1.1.1328920485.1725346503&semt=ais_hybrid" alt="Profile" class="profile-pic">
               
              </div>
            </header><br>
          <div class="items">
            <div class="items-child">
              <div class="card1"><img src="https://img.freepik.com/premium-vector/information-info-square-button-box-help-faq-support-concept-3d-vector-icon-cartoon-minimal-style_365941-1106.jpg?uid=R55814283&ga=GA1.2.1328920485.1725346503&semt=ais_hybrid" alt=""><br>
                Security note:  Please activate <em>Two factor Aunthentication</em> to keep your account.
              </div>
            </div>



            <div class="virtual-card-section">
              <div class="virtual-card">
                
                
                <div class="card-details">
                  <div class="card-logo">
                    <img src="./images/memecoin logo.png" alt="" style="margin-left: 2rem;">
                  </div>
                  <div class="card-number">**** **** **** 1234</div>
                  <div class="card-holder">
                    <span>Card Holder</span>
                    <span>John Doe</span>
                  </div>
                  <div class="card-expiry">
                    <span>Expiry</span>
                    <span>12/25</span>
                  </div>
                  <div class="card-brand">VISA</div>
                </div>
              </div>
            </div>

           
          </div>

          <div class="tabs">
            <div class="tab">
              
              <p id="balance"></p><hr  style="border-style: solid; border-color: rgba(116, 0, 0, 1);">
              <h3>ACOUNT BALANCE</h3>
            </div>

            <div class="tab">
             
              <span id="mostRecentActiveDeposit">0</span></p><hr style="border-style: solid; border-color: rgba(116, 0, 0, 1);">
              <h3>ACTIVE DEPOSIT</h3>
            </div>

          </div>

          <div class="tabs">
            <div class="tab">
              
              <td class="text-right">$<span id="lastDeposit">0</span></td>
              <h3>LAST DEPOSIT</h3>
            </div>

            <!-- <div class="tab">
             
              <span id="mostRecentActiveDeposit">0</span></p><hr style="border-style: solid; border-color: rgba(116, 0, 0, 1);">
              <h3>ACTIVE DEPOSIT</h3>
            </div> -->

          </div>
              

            <br><br><br><b></b>
            
            
           

            
            <table class="bottom-table" cellspacing="0" cellpadding="2" border="0">
              <tbody><tr>
               <td>Pending Withdrawal:</td>
               <td class="text-right">$<span id="totalPendingWithdrawals">0</span></td>
              </tr>
              
           
             <tr>
              <td>Total Approved Deposit:</td>
              <td class="text-right">$<span id="totalDeposits">0</span></td>
             </tr>
           
            
            </tbody></table>


           <div class="affiliate">
            
           </div>
            
            <section class="charts-section">
              <canvas id="investmentChart" style="font-size: 8px;"></canvas>
              <canvas id="cryptoChart"></canvas>
            </section>
            
           
          </main>
           <!-- TradingView Widget BEGIN -->
        <section id="market-cap" class="market-section" >
          <h2>Real-Time Crypto Market</h2>
          <div class="tradingview-widget-container">
              <div class="tradingview-widget-container__widget" style="height:calc(100% - 100px);width:100%"></div>
              <div class="tradingview-widget-copyright">
                  <a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank">
                      <span class="blue-text">Track all markets on TradingView</span>
                  </a>
              </div>
              
          </div>

          <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
              {
                  "width": "100%",
                  "height": "500",
                  "autosize": true,
                  "symbol": "BINANCE:BTCUSDT",
                  "interval": "60",
                  "timezone": "America/New_York",
                  "theme": "light",
                  "style": "1",
                  "locale": "en",
                  "withdateranges": true,
                  "allow_symbol_change": true,
                  "calendar": false,
                  "studies": [
                      "STD;24h%Volume"
                  ],
                  "support_host": "https://www.tradingview.com"
              }
              </script>
      </section>
    </div>
    
</div>
<br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>




<!-- Smartsupp Live Chat script -->
<script type="text/javascript">
  var _smartsupp = _smartsupp || {};
  _smartsupp.key = '9faee08c06a2fffc9ed9081a6c81c4088d7fb63a';
  window.smartsupp||(function(d) {
    var s,c,o=smartsupp=function(){ o._.push(arguments)};o._=[];
    s=d.getElementsByTagName('script')[0];c=d.createElement('script');
    c.type='text/javascript';c.charset='utf-8';c.async=true;
    c.src='https://www.smartsuppchat.com/loader.js?';s.parentNode.insertBefore(c,s);
  })(document);
  </script>
  <noscript> Powered by <a href=“https://www.smartsupp.com” target=“_blank”>Smartsupp</a></noscript>

<script>
  // Client-side JavaScript code
  // Client-side JavaScript code
  const username = localStorage.getItem('username');
fetch(`/users?username=${username}`, {
  method: 'GET',
  headers: {
    'Content-Type': 'application/json'
  }
})
.then(response => response.json())
.then(data => {
  console.log(data);
  // Check if the response data is an array
  if (Array.isArray(data)) {
    
    const userData = data[0];
    document.getElementById('username').innerHTML = `Username: ${userData.username}`;
    document.getElementById('balance').innerHTML = `Balance: ${userData.balance}`;
    document.getElementById('total-deposits').innerHTML = `Total Deposits: ${userData.total_deposits}`;
    
  } else {
    // If it's not an array, handle the error
    console.error('Invalid response data');
  }
})
.catch(error => console.error(error));




// Function to load user dashboard data
async function loadUserDashboard() {
  const username = localStorage.getItem('username'); // Assuming username is stored in localStorage

  if (!username) {
    console.error('Username not found in localStorage');
    return;
  }

  try {
    const response = await fetch(`/api/user-dashboard?username=${username}`);
    const data = await response.json();

    if (response.ok) {
      // Update the DOM with the returned data
      document.getElementById('mostRecentActiveDeposit').textContent = data.mostRecentActiveDeposit || 0;
      document.getElementById('totalPendingWithdrawals').textContent = data.totalPendingWithdrawals || 0;
      document.getElementById('totalWithdrawn').textContent = data.totalWithdrawn || 0;
      document.getElementById('totalEarned').textContent = data.totalEarned || 0;
      document.getElementById('lastDeposit').textContent = data.lastDeposit || 0;
      document.getElementById('totalDeposits').textContent = data.totalDeposits || 0;
      document.getElementById('lastWithdrawal').textContent = data.lastWithdrawal || 0;
    } else {
      console.error('Error fetching data:', data.message);
    }
  } catch (error) {
    console.error('Error fetching user dashboard data:', error);
  }
}

// Call the function when the page loads
window.onload = loadUserDashboard;




const menuBtn = document.querySelector('.menu-btn');
        const topMenu = document.getElementById('topMenu');
        const overlay = document.getElementById('overlay');

        // Toggle Menu and Overlay
        menuBtn.addEventListener('click', () => {
            topMenu.classList.toggle('active');
            overlay.classList.toggle('active');
        });

        // Close Menu when clicking outside
        overlay.addEventListener('click', () => {
            topMenu.classList.remove('active');
            overlay.classList.remove('active');
});
</script>
</body>
</html>